<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secure Express Computer Test</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 20px; }
    .section { display: none; margin-top: 20px; }
    .question { margin-bottom: 15px; }
    button { padding: 10px 20px; font-size: 16px; }
    #results { white-space: pre-wrap; background: #fff; padding: 20px; border-radius: 5px; }
  </style>
</head>
<body>

  <h1>Secure Express Computer Literacy Test</h1>

  <div id="section1" class="section" style="display:block;">
    <label>Full Name:</label>
    <input type="text" id="username" />
    <br/><br/>
    <button onclick="startTest()">Start Test</button>
  </div>

  <div id="section2" class="section">
    <h2>Section 1: Computer Literacy (Multiple Choice)</h2>

    <div class="question">
      <p>1. What is Google Chrome used for?</p>
      <label><input type="radio" name="q1" value="Internet"> Internet</label><br>
      <label><input type="radio" name="q1" value="Text"> Text</label><br>
      <label><input type="radio" name="q1" value="Email"> Email</label><br>
      <label><input type="radio" name="q1" value="Sheet"> Sheet</label>
    </div>

    <div class="question">
      <p>2. What does Ctrl + C do?</p>
      <label><input type="radio" name="q2" value="Copy"> Copy</label><br>
      <label><input type="radio" name="q2" value="Cut"> Cut</label><br>
      <label><input type="radio" name="q2" value="Paste"> Paste</label><br>
      <label><input type="radio" name="q2" value="Close"> Close</label>
    </div>

    <div class="question">
      <p>3. Which software is used to write letters and reports?</p>
      <label><input type="radio" name="q3" value="Word"> Microsoft Word</label><br>
      <label><input type="radio" name="q3" value="Excel"> Microsoft Excel</label><br>
      <label><input type="radio" name="q3" value="Outlook"> Microsoft Outlook</label><br>
      <label><input type="radio" name="q3" value="PowerPoint"> Microsoft PowerPoint</label>
    </div>

    <br>
    <button onclick="nextSection()">Next</button>
  </div>

  <div id="section3" class="section">
    <h2>Section 2: Typing Test</h2>
    <p>Type the following text within 1 minute:</p>
    <blockquote id="typingText">Please type this exact sentence to measure your typing speed and accuracy.</blockquote>
    <textarea id="typedText" rows="5" cols="60" placeholder="Start typing here..."></textarea>
    <br><br>
    <button onclick="submitTest()">Submit Test</button>
  </div>

  <div id="section4" class="section">
    <h2>Results</h2>
    <div id="results"></div>
    <br>
    <button onclick="downloadResults()">Download Results</button>
  </div>

  <script>
    let timer;
    let timeLeft = 60;
    let user = "";

    function startTest() {
      user = document.getElementById("username").value.trim();
      if (user === "" || /[^a-zA-Z\s]/.test(user)) {
        alert("Please enter a valid name without special characters.");
        return;
      }

      if (localStorage.getItem("testStarted")) {
        alert("Test already started. Refreshing or restarting is not allowed.");
        return;
      }

      localStorage.setItem("testStarted", "true");
      showSection("section2");
      document.getElementById("section2").scrollIntoView({ behavior: "smooth" });
    }

    function nextSection() {
      const totalQuestions = 3;
      for (let i = 1; i <= totalQuestions; i++) {
        if (!document.querySelector(`input[name="q${i}"]:checked`)) {
          alert("Please answer all questions before continuing.");
          return;
        }
      }

      showSection("section3");
      document.getElementById("section3").scrollIntoView({ behavior: "smooth" });

      timer = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
          clearInterval(timer);
          submitTest();
        }
      }, 1000);
    }

    function submitTest() {
      clearInterval(timer);

      const answers = {
        q1: "Internet",
        q2: "Copy",
        q3: "Word"
      };

      let score = 0;
      Object.keys(answers).forEach(q => {
        const selected = document.querySelector(`input[name="${q}"]:checked`);
        if (selected && selected.value === answers[q]) score++;
      });

      const typed = document.getElementById("typedText").value.trim();
      const original = document.getElementById("typingText").innerText.trim();

      const typedWords = typed.split(/\s+/);
      const originalWords = original.split(/\s+/);
      const totalTyped = typedWords.length;

      let correct = 0;
      for (let i = 0; i < originalWords.length; i++) {
        if (typedWords[i] === originalWords[i]) correct++;
      }

      const accuracy = Math.round((correct / originalWords.length) * 100);
      const wpm = Math.round((totalTyped / (60 - timeLeft)) * 60);

      showSection("section4");
      document.getElementById("results").innerText =
        `Candidate: ${user}\n\nScore: ${score}/3\n\nTyping Speed: ${wpm} WPM\nTyping Accuracy: ${accuracy}%`;

      localStorage.removeItem("testStarted");
    }

    function downloadResults() {
      const content = document.getElementById("results").innerText;
      const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `TestResults_${user.replace(/\s+/g, '_')}.txt`;
      link.click();
      alert("Results downloaded successfully.");
    }

    function showSection(id) {
      document.querySelectorAll(".section").forEach(s => s.style.display = "none");
      document.getElementById(id).style.display = "block";
    }
  </script>

</body>
</html>
